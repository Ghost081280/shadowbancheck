<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ShadowBanCheck - Site Diagnostic</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #e2e8f0;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            color: #6366f1;
            margin-bottom: 10px;
            font-size: 2rem;
        }
        
        .subtitle {
            text-align: center;
            color: #94a3b8;
            margin-bottom: 30px;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 12px 24px;
            font-size: 1rem;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(99, 102, 241, 0.4);
        }
        
        .btn-secondary {
            background: #334155;
            color: #e2e8f0;
            border: 1px solid #475569;
        }
        
        .btn-secondary:hover {
            background: #475569;
        }
        
        .btn-copy {
            background: #22c55e;
            color: white;
        }
        
        .btn-copy:hover {
            background: #16a34a;
        }
        
        .status-bar {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 15px 20px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        
        .status-dot.pending { background: #64748b; }
        .status-dot.loading { background: #f59e0b; animation: pulse 1s infinite; }
        .status-dot.success { background: #22c55e; }
        .status-dot.error { background: #ef4444; }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .result-card {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 12px;
            overflow: hidden;
        }
        
        .result-card.has-errors {
            border-color: #ef4444;
        }
        
        .result-card.all-good {
            border-color: #22c55e;
        }
        
        .card-header {
            padding: 15px 20px;
            background: #334155;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .card-header h3 {
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .card-header .badge {
            font-size: 0.75rem;
            padding: 4px 10px;
            border-radius: 20px;
            font-weight: 600;
        }
        
        .badge.pending { background: #475569; }
        .badge.loading { background: #f59e0b; color: #000; }
        .badge.success { background: #22c55e; color: #000; }
        .badge.error { background: #ef4444; }
        
        .card-body {
            padding: 20px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .check-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 8px 0;
            border-bottom: 1px solid #334155;
        }
        
        .check-item:last-child {
            border-bottom: none;
        }
        
        .check-icon {
            font-size: 1.1rem;
            flex-shrink: 0;
            width: 24px;
            text-align: center;
        }
        
        .check-content {
            flex: 1;
        }
        
        .check-label {
            font-weight: 500;
            margin-bottom: 2px;
        }
        
        .check-detail {
            font-size: 0.85rem;
            color: #94a3b8;
        }
        
        .check-item.success .check-label { color: #22c55e; }
        .check-item.error .check-label { color: #ef4444; }
        .check-item.warning .check-label { color: #f59e0b; }
        .check-item.info .check-label { color: #6366f1; }
        
        .summary-section {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .summary-section h2 {
            margin-bottom: 15px;
            color: #6366f1;
        }
        
        .summary-stats {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        
        .stat {
            text-align: center;
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
        }
        
        .stat-value.errors { color: #ef4444; }
        .stat-value.warnings { color: #f59e0b; }
        .stat-value.passed { color: #22c55e; }
        
        .stat-label {
            font-size: 0.9rem;
            color: #94a3b8;
        }
        
        .error-list, .warning-list {
            background: #0f172a;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .error-list h4 { color: #ef4444; margin-bottom: 10px; }
        .warning-list h4 { color: #f59e0b; margin-bottom: 10px; }
        
        .error-list li, .warning-list li {
            margin-left: 20px;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }
        
        .json-output {
            background: #0f172a;
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.8rem;
            white-space: pre-wrap;
            word-break: break-all;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .hidden {
            display: none !important;
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(15, 23, 42, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .loading-content {
            text-align: center;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #334155;
            border-top-color: #6366f1;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .iframe-container {
            position: absolute;
            left: -9999px;
            width: 1px;
            height: 1px;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç ShadowBanCheck Site Diagnostic</h1>
        <p class="subtitle">Comprehensive analysis of all pages and functionality</p>
        
        <div class="controls">
            <button class="btn-primary" id="run-diagnostic" onclick="runFullDiagnostic()">
                ‚ñ∂Ô∏è Run Full Diagnostic
            </button>
            <button class="btn-secondary" onclick="clearResults()">
                üóëÔ∏è Clear Results
            </button>
            <button class="btn-copy" onclick="copyResults()">
                üìã Copy Results for Claude
            </button>
        </div>
        
        <div class="status-bar" id="status-bar">
            <div class="status-item">
                <span class="status-dot pending" id="status-index"></span>
                <span>index.html</span>
            </div>
            <div class="status-item">
                <span class="status-dot pending" id="status-checker"></span>
                <span>checker.html</span>
            </div>
            <div class="status-item">
                <span class="status-dot pending" id="status-hashtag"></span>
                <span>hashtag-checker.html</span>
            </div>
            <div class="status-item">
                <span class="status-dot pending" id="status-results"></span>
                <span>results.html</span>
            </div>
        </div>
        
        <div class="summary-section hidden" id="summary-section">
            <h2>üìä Diagnostic Summary</h2>
            <div class="summary-stats">
                <div class="stat">
                    <div class="stat-value errors" id="total-errors">0</div>
                    <div class="stat-label">Errors</div>
                </div>
                <div class="stat">
                    <div class="stat-value warnings" id="total-warnings">0</div>
                    <div class="stat-label">Warnings</div>
                </div>
                <div class="stat">
                    <div class="stat-value passed" id="total-passed">0</div>
                    <div class="stat-label">Passed</div>
                </div>
            </div>
            
            <div class="error-list hidden" id="all-errors">
                <h4>‚ùå All Errors</h4>
                <ul id="error-list-items"></ul>
            </div>
            
            <div class="warning-list hidden" id="all-warnings">
                <h4>‚ö†Ô∏è All Warnings</h4>
                <ul id="warning-list-items"></ul>
            </div>
        </div>
        
        <div class="results-grid" id="results-grid">
            <!-- Results will be inserted here -->
        </div>
        
        <div class="summary-section hidden" id="json-section">
            <h2>üìã JSON Output (Copy this for Claude)</h2>
            <div class="json-output" id="json-output"></div>
        </div>
    </div>
    
    <div class="loading-overlay hidden" id="loading-overlay">
        <div class="loading-content">
            <div class="spinner"></div>
            <p id="loading-text">Running diagnostic...</p>
        </div>
    </div>
    
    <div class="iframe-container" id="iframe-container">
        <!-- Hidden iframes for loading pages -->
    </div>

    <script>
        // Store all results
        var allResults = {
            timestamp: null,
            pages: {},
            summary: {
                totalErrors: 0,
                totalWarnings: 0,
                totalPassed: 0,
                allErrors: [],
                allWarnings: []
            }
        };
        
        var pages = [
            { id: 'index', url: 'index.html', name: 'Home Page (index.html)' },
            { id: 'checker', url: 'checker.html', name: 'Account Checker (checker.html)' },
            { id: 'hashtag', url: 'hashtag-checker.html', name: 'Hashtag Checker (hashtag-checker.html)' },
            { id: 'results', url: 'results.html', name: 'Results Page (results.html)' }
        ];
        
        function setStatus(pageId, status) {
            var dot = document.getElementById('status-' + pageId);
            if (dot) {
                dot.className = 'status-dot ' + status;
            }
        }
        
        function showLoading(show, text) {
            var overlay = document.getElementById('loading-overlay');
            var loadingText = document.getElementById('loading-text');
            if (show) {
                overlay.classList.remove('hidden');
                if (text) loadingText.textContent = text;
            } else {
                overlay.classList.add('hidden');
            }
        }
        
        function clearResults() {
            document.getElementById('results-grid').innerHTML = '';
            document.getElementById('summary-section').classList.add('hidden');
            document.getElementById('json-section').classList.add('hidden');
            pages.forEach(function(p) { setStatus(p.id, 'pending'); });
            allResults = {
                timestamp: null,
                pages: {},
                summary: { totalErrors: 0, totalWarnings: 0, totalPassed: 0, allErrors: [], allWarnings: [] }
            };
        }
        
        function copyResults() {
            var jsonText = JSON.stringify(allResults, null, 2);
            navigator.clipboard.writeText(jsonText).then(function() {
                alert('Results copied to clipboard! Paste them to Claude.');
            }).catch(function() {
                // Fallback
                var textarea = document.createElement('textarea');
                textarea.value = jsonText;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                alert('Results copied! Paste them to Claude.');
            });
        }
        
        function runFullDiagnostic() {
            clearResults();
            showLoading(true, 'Starting diagnostic...');
            allResults.timestamp = new Date().toISOString();
            
            var currentIndex = 0;
            
            function processNext() {
                if (currentIndex >= pages.length) {
                    finalizeDiagnostic();
                    return;
                }
                
                var page = pages[currentIndex];
                showLoading(true, 'Analyzing ' + page.name + '...');
                setStatus(page.id, 'loading');
                
                analyzePage(page, function(result) {
                    allResults.pages[page.id] = result;
                    
                    // Update summary
                    allResults.summary.totalErrors += result.errors.length;
                    allResults.summary.totalWarnings += result.warnings.length;
                    allResults.summary.totalPassed += result.passed;
                    
                    result.errors.forEach(function(e) {
                        allResults.summary.allErrors.push('[' + page.id + '] ' + e);
                    });
                    result.warnings.forEach(function(w) {
                        allResults.summary.allWarnings.push('[' + page.id + '] ' + w);
                    });
                    
                    setStatus(page.id, result.errors.length > 0 ? 'error' : 'success');
                    renderPageResult(page, result);
                    
                    currentIndex++;
                    setTimeout(processNext, 500);
                });
            }
            
            processNext();
        }
        
        function analyzePage(page, callback) {
            var result = {
                page: page.url,
                name: page.name,
                errors: [],
                warnings: [],
                info: [],
                passed: 0,
                checks: []
            };
            
            // Create iframe to load the page
            var iframe = document.createElement('iframe');
            iframe.style.width = '1024px';
            iframe.style.height = '768px';
            iframe.id = 'iframe-' + page.id;
            
            var timeout = setTimeout(function() {
                result.errors.push('Page load timeout');
                cleanup();
                callback(result);
            }, 10000);
            
            function cleanup() {
                clearTimeout(timeout);
                if (iframe.parentNode) {
                    iframe.parentNode.removeChild(iframe);
                }
            }
            
            iframe.onload = function() {
                clearTimeout(timeout);
                
                try {
                    var doc = iframe.contentDocument || iframe.contentWindow.document;
                    var win = iframe.contentWindow;
                    
                    // Wait a bit for scripts to execute
                    setTimeout(function() {
                        runChecks(win, doc, page, result);
                        cleanup();
                        callback(result);
                    }, 2000);
                    
                } catch(e) {
                    result.errors.push('Cannot access iframe: ' + e.message);
                    cleanup();
                    callback(result);
                }
            };
            
            iframe.onerror = function() {
                result.errors.push('Failed to load page');
                cleanup();
                callback(result);
            };
            
            document.getElementById('iframe-container').appendChild(iframe);
            iframe.src = page.url;
        }
        
        function runChecks(win, doc, page, result) {
            // Helper functions
            function addCheck(status, label, detail) {
                result.checks.push({ status: status, label: label, detail: detail });
                if (status === 'success') result.passed++;
                else if (status === 'error') result.errors.push(label + (detail ? ': ' + detail : ''));
                else if (status === 'warning') result.warnings.push(label + (detail ? ': ' + detail : ''));
            }
            
            function checkElement(id, description) {
                var el = doc.getElementById(id);
                if (el) {
                    addCheck('success', description, 'Found #' + id);
                    return el;
                } else {
                    addCheck('error', description + ' NOT FOUND', 'Missing #' + id);
                    return null;
                }
            }
            
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            // GLOBAL CHECKS (run on all pages)
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            
            // Check platformData
            if (typeof win.platformData !== 'undefined' && Array.isArray(win.platformData)) {
                addCheck('success', 'platformData loaded', win.platformData.length + ' platforms: ' + win.platformData.map(function(p) { return p.id; }).join(', '));
            } else {
                addCheck('error', 'platformData NOT LOADED', 'window.platformData is undefined or not an array');
            }
            
            // Check platformsReady
            if (win.platformsReady === true) {
                addCheck('success', 'platformsReady flag set', 'window.platformsReady = true');
            } else {
                addCheck('error', 'platformsReady flag NOT SET', 'window.platformsReady should be true');
            }
            
            // Check utility functions
            var funcs = ['getPlatformById', 'detectPlatformFromUrl', 'getHashtagPlatforms', 'getLivePlatforms'];
            funcs.forEach(function(fn) {
                if (typeof win[fn] === 'function') {
                    addCheck('success', fn + '() exists', 'Function available');
                } else {
                    addCheck('error', fn + '() MISSING', 'Function not defined on window');
                }
            });
            
            // Test getPlatformById
            if (typeof win.getPlatformById === 'function') {
                try {
                    var twitter = win.getPlatformById('twitter');
                    if (twitter && twitter.name) {
                        addCheck('success', 'getPlatformById works', 'twitter = ' + twitter.name);
                    } else {
                        addCheck('error', 'getPlatformById returns null', 'Could not get twitter platform');
                    }
                } catch(e) {
                    addCheck('error', 'getPlatformById threw error', e.message);
                }
            }
            
            // Check script order
            var scripts = doc.querySelectorAll('script[src]');
            var scriptList = [];
            scripts.forEach(function(s) {
                var src = s.getAttribute('src');
                if (src && (src.includes('platforms') || src.includes('index.js') || src.includes('checker') || src.includes('shared') || src.includes('results'))) {
                    scriptList.push(src);
                }
            });
            
            if (scriptList.length > 0) {
                var platformsIdx = scriptList.findIndex(function(s) { return s.includes('platforms'); });
                var pageJsIdx = scriptList.findIndex(function(s) { 
                    return s.includes('index.js') || s.includes('checker.js') || s.includes('hashtag-checker.js') || s.includes('results.js'); 
                });
                
                if (platformsIdx > -1 && pageJsIdx > -1 && platformsIdx < pageJsIdx) {
                    addCheck('success', 'Script order correct', 'platforms.js loads before page JS');
                } else if (platformsIdx > pageJsIdx) {
                    addCheck('error', 'Script order WRONG', 'platforms.js loads AFTER page JS');
                }
                
                result.info.push('Scripts: ' + scriptList.join(', '));
            }
            
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            // PAGE-SPECIFIC CHECKS
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            
            if (page.id === 'index') {
                // Index page checks
                checkElement('power-check-form', 'Power Check Form');
                checkElement('power-url-input', 'URL Input');
                
                var platformGrid = checkElement('platform-grid', 'Platform Grid');
                if (platformGrid) {
                    var items = platformGrid.querySelectorAll('.platform-item');
                    var cards = platformGrid.querySelectorAll('.platform-card');
                    
                    if (items.length > 0) {
                        addCheck('success', 'Platform grid populated', items.length + ' .platform-item elements');
                        
                        // Check for data-platform attributes
                        var withData = platformGrid.querySelectorAll('.platform-item[data-platform]');
                        if (withData.length > 0) {
                            addCheck('success', 'Platform items have data-platform', withData.length + ' clickable items');
                        } else {
                            addCheck('warning', 'Platform items missing data-platform', 'Click handlers may not work');
                        }
                    } else if (cards.length > 0) {
                        addCheck('error', 'Wrong CSS class used', 'Using .platform-card instead of .platform-item (' + cards.length + ' found)');
                    } else {
                        addCheck('error', 'Platform grid EMPTY', 'No .platform-item or .platform-card elements');
                    }
                }
                
                var powerIcons = checkElement('power-platform-icons', 'Platform Icons Container');
                if (powerIcons) {
                    var chips = powerIcons.querySelectorAll('.platform-chip');
                    if (chips.length > 0) {
                        addCheck('success', 'Platform chips found', chips.length + ' chips');
                    } else {
                        addCheck('error', 'No platform chips', 'Missing .platform-chip elements');
                    }
                }
                
                var platformModal = checkElement('platform-modal', 'Platform Modal');
                if (platformModal) {
                    var style = win.getComputedStyle(platformModal);
                    var isHidden = platformModal.classList.contains('hidden') || style.display === 'none';
                    addCheck('info', 'Platform modal state', isHidden ? 'Hidden (correct)' : 'VISIBLE (should be hidden)');
                }
                
                checkElement('power-info-modal', 'Power Info Modal');
                checkElement('engine-animation', 'Engine Animation');
                
                // Check factors
                for (var i = 1; i <= 5; i++) {
                    var factor = doc.getElementById('factor-' + i + '-progress');
                    if (factor) {
                        var statusEl = factor.querySelector('.factor-status');
                        addCheck('success', 'Factor ' + i, statusEl ? 'Has .factor-status' : 'Missing .factor-status');
                    } else {
                        addCheck('error', 'Factor ' + i + ' NOT FOUND', 'Missing #factor-' + i + '-progress');
                    }
                }
            }
            
            if (page.id === 'checker') {
                checkElement('account-check-form', 'Account Check Form');
                checkElement('username-input', 'Username Input');
                
                var select = checkElement('platform-select', 'Platform Dropdown');
                if (select) {
                    var options = select.querySelectorAll('option');
                    var selectable = select.querySelectorAll('option:not(:disabled)');
                    addCheck('info', 'Dropdown options', options.length + ' total, ' + selectable.length + ' selectable');
                    
                    if (selectable.length <= 1) {
                        addCheck('error', 'Dropdown EMPTY', 'No selectable platform options');
                    } else {
                        var optionNames = Array.from(selectable).map(function(o) { return o.textContent.trim(); }).join(', ');
                        addCheck('success', 'Dropdown populated', optionNames);
                    }
                }
                
                checkElement('checker-platform-icons', 'Platform Icons');
                
                // Check factors (checker uses factor-1, factor-2, etc)
                for (var i = 1; i <= 4; i++) {
                    var factor = doc.getElementById('factor-' + i) || doc.getElementById('factor-' + i + '-progress');
                    if (factor) {
                        addCheck('success', 'Factor ' + i, 'Found');
                    } else {
                        addCheck('error', 'Factor ' + i + ' NOT FOUND', 'Missing #factor-' + i);
                    }
                }
            }
            
            if (page.id === 'hashtag') {
                checkElement('hashtag-check-form', 'Hashtag Check Form');
                checkElement('hashtag-input', 'Hashtag Input');
                
                var hashSelect = checkElement('hashtag-platform-select', 'Platform Dropdown');
                if (hashSelect) {
                    var options = hashSelect.querySelectorAll('option');
                    var selectable = hashSelect.querySelectorAll('option:not(:disabled)');
                    
                    // Check for Reddit (should NOT be present)
                    var hasReddit = false;
                    options.forEach(function(o) {
                        if (o.value === 'reddit' || o.textContent.toLowerCase().includes('reddit')) {
                            hasReddit = true;
                        }
                    });
                    
                    if (hasReddit) {
                        addCheck('error', 'Reddit in dropdown', 'Reddit should be EXCLUDED from hashtag checker');
                    } else {
                        addCheck('success', 'Reddit excluded', 'Correctly not showing Reddit');
                    }
                    
                    if (selectable.length === 0) {
                        addCheck('error', 'Dropdown EMPTY', 'No selectable options');
                    } else {
                        var optionNames = Array.from(selectable).map(function(o) { return o.textContent.trim(); }).join(', ');
                        addCheck('success', 'Dropdown populated', optionNames);
                    }
                }
                
                var redditNotice = checkElement('reddit-notice', 'Reddit Notice');
                if (redditNotice) {
                    var style = win.getComputedStyle(redditNotice);
                    var isHidden = redditNotice.classList.contains('hidden') || style.display === 'none';
                    if (isHidden) {
                        addCheck('success', 'Reddit notice hidden', 'Correctly hidden on load');
                    } else {
                        addCheck('error', 'Reddit notice VISIBLE', 'Should be hidden on page load');
                    }
                }
                
                checkElement('hashtag-platform-icons', 'Platform Icons');
                
                // Test getHashtagPlatforms
                if (typeof win.getHashtagPlatforms === 'function') {
                    try {
                        var hashPlatforms = win.getHashtagPlatforms();
                        var hasRedditInFunc = hashPlatforms.some(function(p) { return p.id === 'reddit'; });
                        if (hasRedditInFunc) {
                            addCheck('error', 'getHashtagPlatforms includes Reddit', 'Function should exclude Reddit');
                        } else {
                            addCheck('success', 'getHashtagPlatforms correct', hashPlatforms.map(function(p) { return p.id; }).join(', '));
                        }
                    } catch(e) {
                        addCheck('error', 'getHashtagPlatforms error', e.message);
                    }
                }
            }
            
            if (page.id === 'results') {
                checkElement('probability-value', 'Probability Value');
                checkElement('probability-circle', 'Probability Circle');
                checkElement('result-platform-icon', 'Platform Icon');
                checkElement('result-platform-name', 'Platform Name');
                checkElement('findings-list', 'Findings List');
                checkElement('recommendations-list', 'Recommendations List');
            }
            
            // Check modals
            var modals = doc.querySelectorAll('.modal');
            addCheck('info', 'Modals found', modals.length + ' elements with .modal class');
            
            var modalTriggers = doc.querySelectorAll('[data-modal]');
            addCheck('info', 'Modal triggers', modalTriggers.length + ' elements with [data-modal]');
        }
        
        function renderPageResult(page, result) {
            var grid = document.getElementById('results-grid');
            
            var card = document.createElement('div');
            card.className = 'result-card' + (result.errors.length > 0 ? ' has-errors' : ' all-good');
            
            var statusBadge = result.errors.length > 0 ? 
                '<span class="badge error">' + result.errors.length + ' errors</span>' :
                '<span class="badge success">All Good</span>';
            
            var checksHtml = result.checks.map(function(check) {
                var icon = check.status === 'success' ? '‚úÖ' : 
                          check.status === 'error' ? '‚ùå' : 
                          check.status === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è';
                return '<div class="check-item ' + check.status + '">' +
                    '<span class="check-icon">' + icon + '</span>' +
                    '<div class="check-content">' +
                        '<div class="check-label">' + check.label + '</div>' +
                        (check.detail ? '<div class="check-detail">' + check.detail + '</div>' : '') +
                    '</div>' +
                '</div>';
            }).join('');
            
            card.innerHTML = 
                '<div class="card-header">' +
                    '<h3>' + (result.errors.length > 0 ? '‚ùå' : '‚úÖ') + ' ' + page.name + '</h3>' +
                    statusBadge +
                '</div>' +
                '<div class="card-body">' + checksHtml + '</div>';
            
            grid.appendChild(card);
        }
        
        function finalizeDiagnostic() {
            showLoading(false);
            
            // Update summary
            document.getElementById('total-errors').textContent = allResults.summary.totalErrors;
            document.getElementById('total-warnings').textContent = allResults.summary.totalWarnings;
            document.getElementById('total-passed').textContent = allResults.summary.totalPassed;
            
            document.getElementById('summary-section').classList.remove('hidden');
            
            // Show error list if any
            if (allResults.summary.allErrors.length > 0) {
                var errorList = document.getElementById('all-errors');
                var errorItems = document.getElementById('error-list-items');
                errorItems.innerHTML = allResults.summary.allErrors.map(function(e) {
                    return '<li>' + e + '</li>';
                }).join('');
                errorList.classList.remove('hidden');
            }
            
            // Show warning list if any
            if (allResults.summary.allWarnings.length > 0) {
                var warnList = document.getElementById('all-warnings');
                var warnItems = document.getElementById('warning-list-items');
                warnItems.innerHTML = allResults.summary.allWarnings.map(function(w) {
                    return '<li>' + w + '</li>';
                }).join('');
                warnList.classList.remove('hidden');
            }
            
            // Show JSON
            document.getElementById('json-section').classList.remove('hidden');
            document.getElementById('json-output').textContent = JSON.stringify(allResults, null, 2);
        }
    </script>
</body>
</html>
