<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîß 5-Factor Engine Diagnostic Test</title>
    <style>
        :root {
            --bg: #0a0a0f;
            --card: #12121a;
            --border: #2a2a3a;
            --text: #e4e4e7;
            --muted: #71717a;
            --success: #22c55e;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #3b82f6;
            --primary: #6366f1;
        }
        
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            padding: 1rem;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            padding: 2rem 1rem;
            border-bottom: 1px solid var(--border);
            margin-bottom: 2rem;
        }
        
        h1 { font-size: 1.75rem; margin-bottom: 0.5rem; }
        .subtitle { color: var(--muted); font-size: 0.95rem; }
        
        /* Summary Box */
        .summary-box {
            background: var(--card);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            text-align: center;
        }
        
        .summary-box.success { border-color: var(--success); }
        .summary-box.warning { border-color: var(--warning); }
        .summary-box.error { border-color: var(--danger); }
        
        .summary-title { font-size: 1.5rem; margin-bottom: 0.5rem; }
        
        .summary-stats {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }
        
        .stat { text-align: center; }
        .stat-value { font-size: 2rem; font-weight: bold; }
        .stat-value.success { color: var(--success); }
        .stat-value.warning { color: var(--warning); }
        .stat-value.danger { color: var(--danger); }
        .stat-label { font-size: 0.85rem; color: var(--muted); }
        
        /* Progress */
        .progress-container { margin: 1.5rem 0; }
        .progress-bar {
            height: 8px;
            background: var(--border);
            border-radius: 4px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: var(--primary);
            transition: width 0.3s;
            border-radius: 4px;
        }
        .progress-text {
            text-align: center;
            margin-top: 0.5rem;
            font-size: 0.9rem;
            color: var(--muted);
        }
        
        /* Sections */
        .section {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            margin-bottom: 1.5rem;
            overflow: hidden;
        }
        
        .section-header {
            padding: 1rem 1.5rem;
            background: rgba(99, 102, 241, 0.1);
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }
        
        .section-header:hover { background: rgba(99, 102, 241, 0.15); }
        
        .section-title {
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .section-status {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .section-status.success { background: var(--success); color: #000; }
        .section-status.partial { background: var(--warning); color: #000; }
        .section-status.error { background: var(--danger); color: #fff; }
        .section-status.pending { background: var(--muted); color: #fff; }
        
        .section-content { padding: 1rem 1.5rem; }
        
        /* File List */
        .file-list { list-style: none; }
        
        .file-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            border-radius: 8px;
            margin-bottom: 0.5rem;
            background: var(--bg);
        }
        
        .file-item.loaded { border-left: 3px solid var(--success); }
        .file-item.missing { border-left: 3px solid var(--danger); opacity: 0.8; }
        
        .file-icon { font-size: 1.25rem; width: 28px; text-align: center; }
        .file-info { flex: 1; }
        .file-name { font-family: 'Monaco', 'Consolas', monospace; font-size: 0.85rem; }
        .file-desc { font-size: 0.75rem; color: var(--muted); }
        .file-status { font-size: 0.8rem; padding: 0.25rem 0.5rem; border-radius: 4px; }
        .file-status.loaded { color: var(--success); }
        .file-status.missing { color: var(--danger); }
        
        /* Global Tests */
        .global-test {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--border);
        }
        
        .global-test:last-child { border-bottom: none; }
        .global-icon { font-size: 1.25rem; }
        .global-name { flex: 1; font-family: 'Monaco', 'Consolas', monospace; font-size: 0.85rem; }
        .global-result { font-size: 0.85rem; }
        .global-result.yes { color: var(--success); }
        .global-result.no { color: var(--danger); }
        
        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
        }
        
        .btn-primary { background: var(--primary); color: #fff; }
        .btn-primary:hover { background: #818cf8; }
        .btn-success { background: var(--success); color: #000; }
        
        .btn-group {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 1.5rem;
            flex-wrap: wrap;
        }
        
        /* Issue Box */
        .issue-box {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid var(--danger);
            border-radius: 8px;
            padding: 1rem 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .issue-box h3 { color: var(--danger); margin-bottom: 0.5rem; }
        .issue-box p { color: var(--muted); font-size: 0.9rem; margin-bottom: 0.5rem; }
        .issue-box code {
            background: var(--bg);
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-size: 0.85rem;
        }
        
        /* Footer */
        footer {
            text-align: center;
            padding: 2rem;
            color: var(--muted);
            font-size: 0.85rem;
        }
        
        footer a { color: var(--primary); text-decoration: none; }

        /* Quick Test Output */
        .test-output {
            background: var(--bg);
            padding: 1rem;
            border-radius: 8px;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.8rem;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üîß 5-Factor Engine Diagnostic</h1>
            <p class="subtitle">File Loading & Status Check</p>
        </header>
        
        <!-- Summary Box -->
        <div id="summary-box" class="summary-box">
            <div id="summary-title" class="summary-title">‚è≥ Running Diagnostic...</div>
            <div id="summary-message">Checking all files...</div>
            
            <div class="progress-container">
                <div class="progress-bar">
                    <div id="progress-fill" class="progress-fill" style="width: 0%"></div>
                </div>
                <div id="progress-text" class="progress-text">0 / 0 files</div>
            </div>
            
            <div class="summary-stats">
                <div class="stat">
                    <div id="stat-loaded" class="stat-value success">0</div>
                    <div class="stat-label">Loaded</div>
                </div>
                <div class="stat">
                    <div id="stat-missing" class="stat-value danger">0</div>
                    <div class="stat-label">Missing</div>
                </div>
                <div class="stat">
                    <div id="stat-total" class="stat-value">0</div>
                    <div class="stat-label">Total</div>
                </div>
            </div>
        </div>
        
        <!-- Known Issue Alert -->
        <div id="issue-box" class="issue-box" style="display: none;">
            <h3>‚ö†Ô∏è File Location Issue Detected</h3>
            <p id="issue-text"></p>
        </div>
        
        <!-- Core Files -->
        <div class="section">
            <div class="section-header" onclick="toggleSection('core')">
                <span class="section-title">üìÅ Core Files (js/)</span>
                <span id="core-status" class="section-status pending">...</span>
            </div>
            <div id="core-content" class="section-content">
                <ul id="core-list" class="file-list"></ul>
            </div>
        </div>
        
        <!-- Database Files -->
        <div class="section">
            <div class="section-header" onclick="toggleSection('databases')">
                <span class="section-title">üóÑÔ∏è Databases (js/detection/databases/)</span>
                <span id="databases-status" class="section-status pending">...</span>
            </div>
            <div id="databases-content" class="section-content">
                <ul id="databases-list" class="file-list"></ul>
            </div>
        </div>
        
        <!-- Platform Files -->
        <div class="section">
            <div class="section-header" onclick="toggleSection('platforms')">
                <span class="section-title">üåê Platforms (js/detection/platforms/)</span>
                <span id="platforms-status" class="section-status pending">...</span>
            </div>
            <div id="platforms-content" class="section-content">
                <ul id="platforms-list" class="file-list"></ul>
            </div>
        </div>
        
        <!-- Agent Files -->
        <div class="section">
            <div class="section-header" onclick="toggleSection('agents')">
                <span class="section-title">ü§ñ Agents (js/detection/agents/)</span>
                <span id="agents-status" class="section-status pending">...</span>
            </div>
            <div id="agents-content" class="section-content">
                <ul id="agents-list" class="file-list"></ul>
            </div>
        </div>
        
        <!-- Engine Files -->
        <div class="section">
            <div class="section-header" onclick="toggleSection('engine')">
                <span class="section-title">‚ö° Engine (js/detection/)</span>
                <span id="engine-status" class="section-status pending">...</span>
            </div>
            <div id="engine-content" class="section-content">
                <ul id="engine-list" class="file-list"></ul>
            </div>
        </div>
        
        <!-- Global Variables -->
        <div class="section">
            <div class="section-header" onclick="toggleSection('globals')">
                <span class="section-title">üîó Global Variables</span>
                <span id="globals-status" class="section-status pending">...</span>
            </div>
            <div id="globals-content" class="section-content">
                <div id="globals-list"></div>
            </div>
        </div>
        
        <!-- Quick Test Results -->
        <div id="test-section" class="section" style="display: none;">
            <div class="section-header">
                <span class="section-title">üß™ Quick Test Results</span>
            </div>
            <div class="section-content">
                <div id="test-output" class="test-output"></div>
            </div>
        </div>
        
        <!-- Buttons -->
        <div class="btn-group">
            <button class="btn btn-primary" onclick="runDiagnostic()">üîÑ Re-Run Diagnostic</button>
            <button id="test-btn" class="btn btn-success" onclick="runQuickTest()" style="display: none;">
                ‚úÖ Run Quick Test
            </button>
        </div>
        
        <footer>
            <p>5-Factor Detection Engine Diagnostic</p>
            <p><a href="index.html">‚Üê Back to Home</a></p>
        </footer>
    </div>
    
    <script>
        // =========================================
        // FILE DEFINITIONS - MATCHING YOUR ACTUAL FILES
        // =========================================
        
        const FILES = {
            core: [
                { path: 'js/platforms.js', desc: 'Platform configuration', global: 'platformData' },
                { path: 'js/main.js', desc: 'Shared utilities & EngineStatus', global: 'EngineStatus' },
                { path: 'js/demo-data.js', desc: 'Demo/fallback data', global: 'DemoData' },
                { path: 'js/index.js', desc: 'Home page + FiveFactorLoader', global: 'FiveFactorLoader' },
                { path: 'js/detection-api.js', desc: 'Frontend API client', global: 'DetectionAPI' },
                { path: 'js/checker.js', desc: 'Account checker page', global: null },
                { path: 'js/hashtag-checker.js', desc: 'Hashtag checker page', global: null },
                { path: 'js/results.js', desc: 'Results page', global: null },
            ],
            databases: [
                { path: 'js/detection/databases/flagged-content.js', desc: 'Content patterns', global: 'FlaggedContent' },
                { path: 'js/detection/databases/flagged-hashtags.js', desc: 'Hashtags & cashtags', global: 'FlaggedHashtags' },
                { path: 'js/detection/databases/flagged-mentions.js', desc: 'Mentions database', global: 'FlaggedMentions' },
                { path: 'js/detection/databases/flagged-emojis.js', desc: 'Emoji patterns', global: 'FlaggedEmojis' },
                { path: 'js/detection/databases/flagged-links.js', desc: 'Links/domains', global: 'FlaggedLinks' },
                { path: 'js/detection/databases/flagged-images.js', desc: 'Image detection (Phase 2)', global: 'FlaggedImages' },
                { path: 'js/detection/databases/flagged-videos.js', desc: 'Video detection (Phase 2)', global: 'FlaggedVideos' },
                { path: 'js/detection/databases/flagged-audio.js', desc: 'Audio detection (Phase 3)', global: 'FlaggedAudio' },
            ],
            platforms: [
                { path: 'js/detection/platforms/platform-base.js', desc: 'Base platform class', global: 'PlatformBase' },
                { path: 'js/detection/platforms/twitter.js', desc: 'Twitter/X handler', global: 'TwitterPlatform' },
                { path: 'js/detection/platforms/reddit.js', desc: 'Reddit handler', global: 'RedditPlatform' },
            ],
            agents: [
                { path: 'js/detection/agents/agent-base.js', desc: 'Base agent class', global: 'AgentBase' },
                { path: 'js/detection/agents/agent-platform-api.js', desc: 'Factor 1: Platform API (20%)', global: 'PlatformAPIAgent' },
                { path: 'js/detection/agents/agent-web-analysis.js', desc: 'Factor 2: Web Analysis (20%)', global: 'WebAnalysisAgent' },
                { path: 'js/detection/agents/agent-historical.js', desc: 'Factor 3: Historical (15%)', global: 'HistoricalAgent' },
                { path: 'js/detection/agents/agent-predictive.js', desc: 'Factor 5: Predictive (20%)', global: 'PredictiveAgent' },
            ],
            engine: [
                { path: 'js/detection/5-factor-engine.js', desc: 'Main orchestrator', global: 'FiveFactorEngine' },
            ]
        };
        
        // Check for agent-detection.js in wrong location
        const MISPLACED_FILES = [
            { wrongPath: 'js/agent-detection.js', correctPath: 'js/detection/agents/agent-detection.js', desc: 'Detection Agent (Factor 4)' }
        ];
        
        // Key globals to verify
        const KEY_GLOBALS = [
            { name: 'platformData', desc: 'Platform config' },
            { name: 'EngineStatus', desc: 'Engine status' },
            { name: 'FiveFactorLoader', desc: 'Engine loader' },
            { name: 'DemoData', desc: 'Demo data' },
            { name: 'FlaggedHashtags', desc: 'Hashtag DB' },
            { name: 'FlaggedContent', desc: 'Content DB' },
            { name: 'FlaggedLinks', desc: 'Links DB' },
            { name: 'PlatformBase', desc: 'Platform base' },
            { name: 'PlatformFactory', desc: 'Platform factory' },
            { name: 'FiveFactorEngine', desc: 'Main engine' },
            { name: 'powerCheck', desc: 'Power check fn' },
            { name: 'checkAccount', desc: 'Account check fn' },
            { name: 'checkTags', desc: 'Tag check fn' },
        ];
        
        // =========================================
        // STATE
        // =========================================
        
        let results = { loaded: 0, missing: 0, total: 0, errors: [], misplaced: [] };
        
        // =========================================
        // FUNCTIONS
        // =========================================
        
        async function checkFile(fileDef) {
            return new Promise((resolve) => {
                const script = document.createElement('script');
                script.src = fileDef.path + '?t=' + Date.now();
                script.onload = () => resolve({ ...fileDef, status: 'loaded' });
                script.onerror = () => resolve({ ...fileDef, status: 'missing' });
                document.head.appendChild(script);
            });
        }
        
        async function checkMisplacedFile(fileDef) {
            return new Promise((resolve) => {
                const script = document.createElement('script');
                script.src = fileDef.wrongPath + '?t=' + Date.now();
                script.onload = () => resolve({ ...fileDef, found: true });
                script.onerror = () => resolve({ ...fileDef, found: false });
                document.head.appendChild(script);
            });
        }
        
        function updateProgress(current, total) {
            const pct = Math.round((current / total) * 100);
            document.getElementById('progress-fill').style.width = pct + '%';
            document.getElementById('progress-text').textContent = `${current} / ${total} files`;
        }
        
        function renderFileList(category, fileResults) {
            const list = document.getElementById(category + '-list');
            const statusEl = document.getElementById(category + '-status');
            
            let html = '';
            let loadedCount = 0;
            
            fileResults.forEach(file => {
                const isLoaded = file.status === 'loaded';
                if (isLoaded) loadedCount++;
                
                html += `
                    <li class="file-item ${isLoaded ? 'loaded' : 'missing'}">
                        <span class="file-icon">${isLoaded ? '‚úÖ' : '‚ùå'}</span>
                        <div class="file-info">
                            <div class="file-name">${file.path}</div>
                            <div class="file-desc">${file.desc}${file.global ? ' ‚Üí window.' + file.global : ''}</div>
                        </div>
                        <span class="file-status ${isLoaded ? 'loaded' : 'missing'}">${isLoaded ? 'Loaded' : 'Missing'}</span>
                    </li>
                `;
            });
            
            list.innerHTML = html;
            
            if (loadedCount === fileResults.length) {
                statusEl.textContent = `${loadedCount}/${fileResults.length} ‚úì`;
                statusEl.className = 'section-status success';
            } else if (loadedCount > 0) {
                statusEl.textContent = `${loadedCount}/${fileResults.length}`;
                statusEl.className = 'section-status partial';
            } else {
                statusEl.textContent = `0/${fileResults.length}`;
                statusEl.className = 'section-status error';
            }
        }
        
        function checkGlobals() {
            const container = document.getElementById('globals-list');
            const statusEl = document.getElementById('globals-status');
            
            let html = '';
            let available = 0;
            
            KEY_GLOBALS.forEach(g => {
                const exists = typeof window[g.name] !== 'undefined';
                if (exists) available++;
                
                html += `
                    <div class="global-test">
                        <span class="global-icon">${exists ? '‚úÖ' : '‚ùå'}</span>
                        <span class="global-name">window.${g.name}</span>
                        <span class="global-result ${exists ? 'yes' : 'no'}">${exists ? 'OK' : 'Missing'}</span>
                    </div>
                `;
            });
            
            container.innerHTML = html;
            
            if (available === KEY_GLOBALS.length) {
                statusEl.textContent = `${available}/${KEY_GLOBALS.length} ‚úì`;
                statusEl.className = 'section-status success';
            } else if (available > 0) {
                statusEl.textContent = `${available}/${KEY_GLOBALS.length}`;
                statusEl.className = 'section-status partial';
            } else {
                statusEl.textContent = `0/${KEY_GLOBALS.length}`;
                statusEl.className = 'section-status error';
            }
        }
        
        function updateSummary() {
            const summaryBox = document.getElementById('summary-box');
            const titleEl = document.getElementById('summary-title');
            const messageEl = document.getElementById('summary-message');
            
            document.getElementById('stat-loaded').textContent = results.loaded;
            document.getElementById('stat-missing').textContent = results.missing;
            document.getElementById('stat-total').textContent = results.total;
            
            if (results.missing === 0 && results.misplaced.length === 0) {
                summaryBox.className = 'summary-box success';
                titleEl.textContent = '‚úÖ All Files Loaded!';
                messageEl.textContent = 'The 5-Factor Engine is ready.';
                document.getElementById('test-btn').style.display = 'inline-flex';
            } else if (results.loaded > 0) {
                summaryBox.className = 'summary-box warning';
                titleEl.textContent = '‚ö†Ô∏è Some Issues Found';
                messageEl.textContent = `${results.missing} missing file(s). See details below.`;
            } else {
                summaryBox.className = 'summary-box error';
                titleEl.textContent = '‚ùå Files Not Found';
                messageEl.textContent = 'Check your folder structure.';
            }
            
            // Show misplaced file warning
            if (results.misplaced.length > 0) {
                const issueBox = document.getElementById('issue-box');
                const issueText = document.getElementById('issue-text');
                issueBox.style.display = 'block';
                
                let issueHtml = '';
                results.misplaced.forEach(f => {
                    issueHtml += `<code>${f.wrongPath}</code> should be moved to <code>${f.correctPath}</code><br>`;
                });
                issueText.innerHTML = issueHtml;
            }
        }
        
        async function runDiagnostic() {
            results = { loaded: 0, missing: 0, total: 0, errors: [], misplaced: [] };
            
            // Reset UI
            document.getElementById('summary-box').className = 'summary-box';
            document.getElementById('summary-title').textContent = '‚è≥ Running...';
            document.getElementById('test-btn').style.display = 'none';
            document.getElementById('test-section').style.display = 'none';
            document.getElementById('issue-box').style.display = 'none';
            
            const categories = ['core', 'databases', 'platforms', 'agents', 'engine'];
            let allFiles = [];
            categories.forEach(cat => allFiles = allFiles.concat(FILES[cat]));
            results.total = allFiles.length;
            
            // Check all files
            let checked = 0;
            for (const category of categories) {
                const categoryResults = [];
                
                for (const file of FILES[category]) {
                    const result = await checkFile(file);
                    categoryResults.push(result);
                    
                    if (result.status === 'loaded') results.loaded++;
                    else results.missing++;
                    
                    checked++;
                    updateProgress(checked, results.total);
                    await new Promise(r => setTimeout(r, 30));
                }
                
                renderFileList(category, categoryResults);
            }
            
            // Check for misplaced files
            for (const misplaced of MISPLACED_FILES) {
                const result = await checkMisplacedFile(misplaced);
                if (result.found) {
                    results.misplaced.push(result);
                }
            }
            
            // Wait for scripts to execute
            await new Promise(r => setTimeout(r, 500));
            
            // Check globals
            checkGlobals();
            
            // Update summary
            updateSummary();
        }
        
        async function runQuickTest() {
            const section = document.getElementById('test-section');
            const output = document.getElementById('test-output');
            
            section.style.display = 'block';
            output.textContent = 'Running tests...\n\n';
            
            const lines = [];
            
            // Test EngineStatus
            lines.push('=== EngineStatus ===');
            if (window.EngineStatus) {
                lines.push('‚úÖ Available');
                lines.push(`   Ready: ${EngineStatus.isReady()}`);
                lines.push(`   Health: ${EngineStatus.getHealthLabel()}`);
            } else {
                lines.push('‚ùå Not available');
            }
            
            // Test DemoData
            lines.push('\n=== DemoData ===');
            if (window.DemoData) {
                lines.push('‚úÖ Available');
                lines.push(`   Platforms: ${DemoData.getAvailablePlatforms().join(', ')}`);
            } else {
                lines.push('‚ùå Not available');
            }
            
            // Test FlaggedHashtags
            lines.push('\n=== FlaggedHashtags ===');
            if (window.FlaggedHashtags) {
                lines.push('‚úÖ Available');
                if (FlaggedHashtags.check) {
                    const test = FlaggedHashtags.check('#followback', 'twitter');
                    lines.push(`   Test #followback: ${test.status || 'unknown'}`);
                }
                if (FlaggedHashtags.getStats) {
                    const stats = FlaggedHashtags.getStats();
                    lines.push(`   Total tags: ${stats.total || 'N/A'}`);
                }
            } else {
                lines.push('‚ùå Not available');
            }
            
            // Test FlaggedContent
            lines.push('\n=== FlaggedContent ===');
            if (window.FlaggedContent) {
                lines.push('‚úÖ Available');
                if (FlaggedContent.analyze) {
                    const test = FlaggedContent.analyze('free crypto giveaway');
                    lines.push(`   Issues found: ${test.issues?.length || 0}`);
                }
            } else {
                lines.push('‚ùå Not available');
            }
            
            // Test FlaggedLinks
            lines.push('\n=== FlaggedLinks ===');
            if (window.FlaggedLinks) {
                lines.push('‚úÖ Available');
                if (FlaggedLinks.checkUrl) {
                    const test = FlaggedLinks.checkUrl('https://bit.ly/test');
                    lines.push(`   Test bit.ly: ${test.status || 'unknown'}`);
                }
            } else {
                lines.push('‚ùå Not available');
            }
            
            // Test powerCheck
            lines.push('\n=== powerCheck ===');
            if (window.powerCheck) {
                lines.push('‚úÖ Available');
                try {
                    const result = await powerCheck('https://x.com/test/status/123');
                    lines.push(`   Verdict: ${result.combinedVerdict || result.verdict || 'OK'}`);
                } catch (e) {
                    lines.push(`   Error: ${e.message}`);
                }
            } else {
                lines.push('‚ùå Not available');
            }
            
            // Test checkTags
            lines.push('\n=== checkTags ===');
            if (window.checkTags) {
                lines.push('‚úÖ Available');
                try {
                    const result = await checkTags(['#test', '#followback'], 'twitter');
                    lines.push(`   Total: ${result.summary?.total || 'N/A'}`);
                    lines.push(`   Banned: ${result.summary?.banned || 0}`);
                } catch (e) {
                    lines.push(`   Error: ${e.message}`);
                }
            } else {
                lines.push('‚ùå Not available');
            }
            
            output.textContent = lines.join('\n');
        }
        
        function toggleSection(id) {
            const content = document.getElementById(id + '-content');
            content.style.display = content.style.display === 'none' ? 'block' : 'none';
        }
        
        // Run on load
        document.addEventListener('DOMContentLoaded', () => setTimeout(runDiagnostic, 100));
    </script>
</body>
</html>
