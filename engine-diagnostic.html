<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîß 5-Factor Engine Diagnostic Test</title>
    <style>
        :root {
            --bg: #0a0a0f;
            --card: #12121a;
            --border: #2a2a3a;
            --text: #e4e4e7;
            --muted: #71717a;
            --success: #22c55e;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #3b82f6;
            --primary: #6366f1;
        }
        
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            padding: 1rem;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            padding: 2rem 1rem;
            border-bottom: 1px solid var(--border);
            margin-bottom: 2rem;
        }
        
        h1 {
            font-size: 1.75rem;
            margin-bottom: 0.5rem;
        }
        
        .subtitle {
            color: var(--muted);
            font-size: 0.95rem;
        }
        
        /* Status Summary */
        .summary-box {
            background: var(--card);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            text-align: center;
        }
        
        .summary-box.success { border-color: var(--success); }
        .summary-box.warning { border-color: var(--warning); }
        .summary-box.error { border-color: var(--danger); }
        
        .summary-title {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }
        
        .summary-stats {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }
        
        .stat {
            text-align: center;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
        }
        
        .stat-value.success { color: var(--success); }
        .stat-value.warning { color: var(--warning); }
        .stat-value.danger { color: var(--danger); }
        
        .stat-label {
            font-size: 0.85rem;
            color: var(--muted);
        }
        
        /* Progress */
        .progress-container {
            margin: 1.5rem 0;
        }
        
        .progress-bar {
            height: 8px;
            background: var(--border);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: var(--primary);
            transition: width 0.3s;
            border-radius: 4px;
        }
        
        .progress-text {
            text-align: center;
            margin-top: 0.5rem;
            font-size: 0.9rem;
            color: var(--muted);
        }
        
        /* Sections */
        .section {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            margin-bottom: 1.5rem;
            overflow: hidden;
        }
        
        .section-header {
            padding: 1rem 1.5rem;
            background: rgba(99, 102, 241, 0.1);
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }
        
        .section-header:hover {
            background: rgba(99, 102, 241, 0.15);
        }
        
        .section-title {
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .section-status {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .section-status.success { background: var(--success); color: #000; }
        .section-status.partial { background: var(--warning); color: #000; }
        .section-status.error { background: var(--danger); color: #fff; }
        .section-status.pending { background: var(--muted); color: #fff; }
        
        .section-content {
            padding: 1rem 1.5rem;
        }
        
        /* File List */
        .file-list {
            list-style: none;
        }
        
        .file-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            border-radius: 8px;
            margin-bottom: 0.5rem;
            background: var(--bg);
        }
        
        .file-item.loaded {
            border-left: 3px solid var(--success);
        }
        
        .file-item.missing {
            border-left: 3px solid var(--danger);
            opacity: 0.8;
        }
        
        .file-item.loading {
            border-left: 3px solid var(--warning);
        }
        
        .file-icon {
            font-size: 1.25rem;
            width: 28px;
            text-align: center;
        }
        
        .file-info {
            flex: 1;
        }
        
        .file-name {
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.9rem;
        }
        
        .file-desc {
            font-size: 0.75rem;
            color: var(--muted);
        }
        
        .file-status {
            font-size: 0.8rem;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
        }
        
        .file-status.loaded { color: var(--success); }
        .file-status.missing { color: var(--danger); }
        .file-status.loading { color: var(--warning); }
        
        /* Error Log */
        .error-log {
            background: #1a0a0a;
            border: 1px solid var(--danger);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .error-log h4 {
            color: var(--danger);
            margin-bottom: 0.5rem;
        }
        
        .error-item {
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.8rem;
            color: #ff6b6b;
            padding: 0.25rem 0;
            border-bottom: 1px solid rgba(239, 68, 68, 0.2);
        }
        
        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background: var(--primary);
            color: #fff;
        }
        
        .btn-primary:hover {
            background: #818cf8;
        }
        
        .btn-success {
            background: var(--success);
            color: #000;
        }
        
        .btn-group {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 1.5rem;
            flex-wrap: wrap;
        }
        
        /* Instructions */
        .instructions {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid var(--info);
            border-radius: 8px;
            padding: 1rem 1.5rem;
            margin-bottom: 2rem;
        }
        
        .instructions h3 {
            color: var(--info);
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }
        
        .instructions ol {
            margin-left: 1.25rem;
            color: var(--muted);
        }
        
        .instructions li {
            margin-bottom: 0.25rem;
        }
        
        /* Global Tests */
        .global-test {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem 0;
        }
        
        .global-icon {
            font-size: 1.25rem;
        }
        
        .global-name {
            flex: 1;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.9rem;
        }
        
        .global-result {
            font-size: 0.85rem;
        }
        
        .global-result.yes { color: var(--success); }
        .global-result.no { color: var(--danger); }
        
        /* Footer */
        footer {
            text-align: center;
            padding: 2rem;
            color: var(--muted);
            font-size: 0.85rem;
        }
        
        footer a {
            color: var(--primary);
            text-decoration: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üîß 5-Factor Engine Diagnostic</h1>
            <p class="subtitle">File Loading Test & Status Check</p>
        </header>
        
        <!-- Summary Box -->
        <div id="summary-box" class="summary-box">
            <div id="summary-title" class="summary-title">‚è≥ Running Diagnostic...</div>
            <div id="summary-message">Checking all required files...</div>
            
            <div class="progress-container">
                <div class="progress-bar">
                    <div id="progress-fill" class="progress-fill" style="width: 0%"></div>
                </div>
                <div id="progress-text" class="progress-text">0 / 0 files checked</div>
            </div>
            
            <div class="summary-stats">
                <div class="stat">
                    <div id="stat-loaded" class="stat-value success">0</div>
                    <div class="stat-label">Loaded</div>
                </div>
                <div class="stat">
                    <div id="stat-missing" class="stat-value danger">0</div>
                    <div class="stat-label">Missing</div>
                </div>
                <div class="stat">
                    <div id="stat-total" class="stat-value">0</div>
                    <div class="stat-label">Total</div>
                </div>
            </div>
        </div>
        
        <!-- Instructions -->
        <div class="instructions" id="instructions" style="display: none;">
            <h3>üìã Missing Files Detected</h3>
            <ol>
                <li>Download missing files from the outputs folder</li>
                <li>Copy them to the correct location in your project</li>
                <li>Refresh this page to re-test</li>
            </ol>
        </div>
        
        <!-- Core Files Section -->
        <div class="section">
            <div class="section-header" onclick="toggleSection('core')">
                <span class="section-title">üìÅ Core Files</span>
                <span id="core-status" class="section-status pending">Checking...</span>
            </div>
            <div id="core-content" class="section-content">
                <ul id="core-list" class="file-list"></ul>
            </div>
        </div>
        
        <!-- Database Files Section -->
        <div class="section">
            <div class="section-header" onclick="toggleSection('databases')">
                <span class="section-title">üóÑÔ∏è Detection Databases</span>
                <span id="databases-status" class="section-status pending">Checking...</span>
            </div>
            <div id="databases-content" class="section-content">
                <ul id="databases-list" class="file-list"></ul>
            </div>
        </div>
        
        <!-- Platform Files Section -->
        <div class="section">
            <div class="section-header" onclick="toggleSection('platforms')">
                <span class="section-title">üåê Platform Handlers</span>
                <span id="platforms-status" class="section-status pending">Checking...</span>
            </div>
            <div id="platforms-content" class="section-content">
                <ul id="platforms-list" class="file-list"></ul>
            </div>
        </div>
        
        <!-- Agent Files Section -->
        <div class="section">
            <div class="section-header" onclick="toggleSection('agents')">
                <span class="section-title">ü§ñ Detection Agents</span>
                <span id="agents-status" class="section-status pending">Checking...</span>
            </div>
            <div id="agents-content" class="section-content">
                <ul id="agents-list" class="file-list"></ul>
            </div>
        </div>
        
        <!-- Engine & API Section -->
        <div class="section">
            <div class="section-header" onclick="toggleSection('engine')">
                <span class="section-title">‚ö° Engine & API</span>
                <span id="engine-status" class="section-status pending">Checking...</span>
            </div>
            <div id="engine-content" class="section-content">
                <ul id="engine-list" class="file-list"></ul>
            </div>
        </div>
        
        <!-- Global Variables Section -->
        <div class="section">
            <div class="section-header" onclick="toggleSection('globals')">
                <span class="section-title">üîó Global Variables Check</span>
                <span id="globals-status" class="section-status pending">Checking...</span>
            </div>
            <div id="globals-content" class="section-content">
                <div id="globals-list"></div>
            </div>
        </div>
        
        <!-- Error Log -->
        <div id="error-section" class="section" style="display: none;">
            <div class="section-header">
                <span class="section-title">‚ùå Errors Detected</span>
            </div>
            <div class="section-content">
                <div id="error-log" class="error-log"></div>
            </div>
        </div>
        
        <!-- Action Buttons -->
        <div class="btn-group">
            <button class="btn btn-primary" onclick="runDiagnostic()">üîÑ Re-Run Diagnostic</button>
            <button class="btn btn-success" onclick="runQuickTest()" id="quick-test-btn" style="display: none;">
                ‚úÖ Run Quick Test
            </button>
        </div>
        
        <!-- Quick Test Results -->
        <div id="quick-test-results" class="section" style="display: none; margin-top: 1.5rem;">
            <div class="section-header">
                <span class="section-title">üß™ Quick Test Results</span>
            </div>
            <div class="section-content">
                <pre id="quick-test-output" style="background: var(--bg); padding: 1rem; border-radius: 8px; overflow-x: auto; font-size: 0.8rem;"></pre>
            </div>
        </div>
        
        <footer>
            <p>5-Factor Detection Engine Diagnostic Tool</p>
            <p style="margin-top: 0.5rem;"><a href="index.html">‚Üê Back to Home</a></p>
        </footer>
    </div>
    
    <script>
        // =========================================
        // FILE DEFINITIONS
        // =========================================
        
        const FILES = {
            core: [
                { path: 'js/platforms.js', desc: 'Platform configuration data', global: 'platformData' },
                { path: 'js/main.js', desc: 'Shared utilities & EngineStatus', global: 'EngineStatus' },
                { path: 'js/demo-data.js', desc: 'Demo/fallback data', global: 'DemoData' },
                { path: 'js/index.js', desc: 'Home page + FiveFactorLoader', global: 'FiveFactorLoader' },
                { path: 'js/checker.js', desc: 'Account checker page', global: null },
                { path: 'js/hashtag-checker.js', desc: 'Hashtag checker page', global: null },
                { path: 'js/results.js', desc: 'Results page', global: null },
            ],
            databases: [
                { path: 'js/detection/databases/flagged-content.js', desc: 'Content patterns database', global: 'FlaggedContent' },
                { path: 'js/detection/databases/flagged-hashtags.js', desc: 'Hashtag/cashtag database', global: 'FlaggedHashtags' },
                { path: 'js/detection/databases/flagged-mentions.js', desc: 'Mentions database', global: 'FlaggedMentions' },
                { path: 'js/detection/databases/flagged-emojis.js', desc: 'Emoji patterns database', global: 'FlaggedEmojis' },
                { path: 'js/detection/databases/flagged-links.js', desc: 'Links/domains database', global: 'FlaggedLinks' },
                { path: 'js/detection/databases/phase2-placeholder.js', desc: 'Phase 2 placeholder', global: 'Phase2Placeholder' },
                { path: 'js/detection/databases/phase3-placeholder.js', desc: 'Phase 3 placeholder', global: 'Phase3Placeholder' },
            ],
            platforms: [
                { path: 'js/detection/platforms/platform-base.js', desc: 'Base platform class', global: 'PlatformBase' },
                { path: 'js/detection/platforms/twitter.js', desc: 'Twitter/X handler', global: 'TwitterPlatform' },
                { path: 'js/detection/platforms/reddit.js', desc: 'Reddit handler', global: 'RedditPlatform' },
            ],
            agents: [
                { path: 'js/detection/agents/platform-api-agent.js', desc: 'Factor 1: Platform API (20%)', global: 'PlatformAPIAgent' },
                { path: 'js/detection/agents/web-analysis-agent.js', desc: 'Factor 2: Web Analysis (20%)', global: 'WebAnalysisAgent' },
                { path: 'js/detection/agents/historical-agent.js', desc: 'Factor 3: Historical Data (15%)', global: 'HistoricalAgent' },
                { path: 'js/detection/agents/detection-agent.js', desc: 'Factor 4: Detection Engine (25%)', global: 'DetectionAgent' },
                { path: 'js/detection/agents/predictive-agent.js', desc: 'Factor 5: Predictive AI (20%)', global: 'PredictiveAgent' },
            ],
            engine: [
                { path: 'js/detection/5-factor-engine.js', desc: 'Main orchestrator engine', global: 'FiveFactorEngine' },
                { path: 'js/detection-api.js', desc: 'Frontend API client', global: 'DetectionAPI' },
            ]
        };
        
        // Key globals to check
        const KEY_GLOBALS = [
            { name: 'platformData', desc: 'Platform configuration' },
            { name: 'EngineStatus', desc: 'Engine status utilities' },
            { name: 'FiveFactorLoader', desc: 'Engine loader' },
            { name: 'DemoData', desc: 'Demo data provider' },
            { name: 'FlaggedHashtags', desc: 'Hashtag database' },
            { name: 'FlaggedContent', desc: 'Content database' },
            { name: 'FlaggedLinks', desc: 'Links database' },
            { name: 'PlatformFactory', desc: 'Platform factory' },
            { name: 'FiveFactorEngine', desc: 'Main engine' },
            { name: 'powerCheck', desc: 'Power check function' },
            { name: 'checkAccount', desc: 'Account check function' },
            { name: 'checkTags', desc: 'Tag check function' },
        ];
        
        // =========================================
        // STATE
        // =========================================
        
        let results = {
            loaded: 0,
            missing: 0,
            total: 0,
            errors: [],
            files: {}
        };
        
        // =========================================
        // DIAGNOSTIC FUNCTIONS
        // =========================================
        
        async function checkFile(fileDef) {
            return new Promise((resolve) => {
                const script = document.createElement('script');
                script.src = fileDef.path + '?t=' + Date.now(); // Cache bust
                
                script.onload = () => {
                    resolve({ ...fileDef, status: 'loaded' });
                };
                
                script.onerror = () => {
                    resolve({ ...fileDef, status: 'missing' });
                };
                
                document.head.appendChild(script);
            });
        }
        
        function updateProgress(current, total) {
            const pct = Math.round((current / total) * 100);
            document.getElementById('progress-fill').style.width = pct + '%';
            document.getElementById('progress-text').textContent = `${current} / ${total} files checked`;
        }
        
        function renderFileList(category, fileResults) {
            const list = document.getElementById(category + '-list');
            const statusEl = document.getElementById(category + '-status');
            
            let html = '';
            let loadedCount = 0;
            
            fileResults.forEach(file => {
                const isLoaded = file.status === 'loaded';
                if (isLoaded) loadedCount++;
                
                const icon = isLoaded ? '‚úÖ' : '‚ùå';
                const statusText = isLoaded ? 'Loaded' : 'Missing';
                const statusClass = isLoaded ? 'loaded' : 'missing';
                
                html += `
                    <li class="file-item ${statusClass}">
                        <span class="file-icon">${icon}</span>
                        <div class="file-info">
                            <div class="file-name">${file.path}</div>
                            <div class="file-desc">${file.desc}</div>
                        </div>
                        <span class="file-status ${statusClass}">${statusText}</span>
                    </li>
                `;
            });
            
            list.innerHTML = html;
            
            // Update section status
            if (loadedCount === fileResults.length) {
                statusEl.textContent = `${loadedCount}/${fileResults.length} ‚úì`;
                statusEl.className = 'section-status success';
            } else if (loadedCount > 0) {
                statusEl.textContent = `${loadedCount}/${fileResults.length}`;
                statusEl.className = 'section-status partial';
            } else {
                statusEl.textContent = `0/${fileResults.length}`;
                statusEl.className = 'section-status error';
            }
        }
        
        function checkGlobals() {
            const container = document.getElementById('globals-list');
            const statusEl = document.getElementById('globals-status');
            
            let html = '';
            let available = 0;
            
            KEY_GLOBALS.forEach(g => {
                const exists = typeof window[g.name] !== 'undefined';
                if (exists) available++;
                
                html += `
                    <div class="global-test">
                        <span class="global-icon">${exists ? '‚úÖ' : '‚ùå'}</span>
                        <span class="global-name">window.${g.name}</span>
                        <span class="global-result ${exists ? 'yes' : 'no'}">${exists ? 'Available' : 'Missing'}</span>
                    </div>
                `;
            });
            
            container.innerHTML = html;
            
            if (available === KEY_GLOBALS.length) {
                statusEl.textContent = `${available}/${KEY_GLOBALS.length} ‚úì`;
                statusEl.className = 'section-status success';
            } else if (available > 0) {
                statusEl.textContent = `${available}/${KEY_GLOBALS.length}`;
                statusEl.className = 'section-status partial';
            } else {
                statusEl.textContent = `0/${KEY_GLOBALS.length}`;
                statusEl.className = 'section-status error';
            }
        }
        
        function updateSummary() {
            const summaryBox = document.getElementById('summary-box');
            const titleEl = document.getElementById('summary-title');
            const messageEl = document.getElementById('summary-message');
            
            document.getElementById('stat-loaded').textContent = results.loaded;
            document.getElementById('stat-missing').textContent = results.missing;
            document.getElementById('stat-total').textContent = results.total;
            
            if (results.missing === 0) {
                summaryBox.className = 'summary-box success';
                titleEl.textContent = '‚úÖ All Files Loaded!';
                messageEl.textContent = 'The 5-Factor Engine is ready to use.';
                document.getElementById('quick-test-btn').style.display = 'inline-flex';
                document.getElementById('instructions').style.display = 'none';
            } else if (results.loaded > 0) {
                summaryBox.className = 'summary-box warning';
                titleEl.textContent = '‚ö†Ô∏è Some Files Missing';
                messageEl.textContent = `${results.missing} file(s) could not be loaded. See details below.`;
                document.getElementById('instructions').style.display = 'block';
            } else {
                summaryBox.className = 'summary-box error';
                titleEl.textContent = '‚ùå No Files Loaded';
                messageEl.textContent = 'None of the engine files could be found. Check your folder structure.';
                document.getElementById('instructions').style.display = 'block';
            }
            
            // Show errors if any
            if (results.errors.length > 0) {
                document.getElementById('error-section').style.display = 'block';
                document.getElementById('error-log').innerHTML = results.errors
                    .map(e => `<div class="error-item">${e}</div>`)
                    .join('');
            }
        }
        
        async function runDiagnostic() {
            // Reset state
            results = { loaded: 0, missing: 0, total: 0, errors: [], files: {} };
            
            // Calculate total files
            const allCategories = ['core', 'databases', 'platforms', 'agents', 'engine'];
            let allFiles = [];
            allCategories.forEach(cat => {
                allFiles = allFiles.concat(FILES[cat]);
            });
            results.total = allFiles.length;
            
            // Reset UI
            document.getElementById('summary-box').className = 'summary-box';
            document.getElementById('summary-title').textContent = '‚è≥ Running Diagnostic...';
            document.getElementById('summary-message').textContent = 'Checking all required files...';
            document.getElementById('quick-test-btn').style.display = 'none';
            document.getElementById('quick-test-results').style.display = 'none';
            document.getElementById('error-section').style.display = 'none';
            
            allCategories.forEach(cat => {
                document.getElementById(cat + '-status').textContent = 'Checking...';
                document.getElementById(cat + '-status').className = 'section-status pending';
            });
            
            // Check files by category
            let checked = 0;
            
            for (const category of allCategories) {
                const categoryResults = [];
                
                for (const file of FILES[category]) {
                    const result = await checkFile(file);
                    categoryResults.push(result);
                    
                    if (result.status === 'loaded') {
                        results.loaded++;
                    } else {
                        results.missing++;
                        results.errors.push(`Missing: ${file.path}`);
                    }
                    
                    checked++;
                    updateProgress(checked, results.total);
                    
                    // Small delay to show progress
                    await new Promise(r => setTimeout(r, 50));
                }
                
                results.files[category] = categoryResults;
                renderFileList(category, categoryResults);
            }
            
            // Check globals after all scripts loaded
            await new Promise(r => setTimeout(r, 500));
            checkGlobals();
            
            // Update summary
            updateSummary();
        }
        
        function toggleSection(sectionId) {
            const content = document.getElementById(sectionId + '-content');
            content.style.display = content.style.display === 'none' ? 'block' : 'none';
        }
        
        // =========================================
        // QUICK TEST
        // =========================================
        
        async function runQuickTest() {
            const resultsSection = document.getElementById('quick-test-results');
            const output = document.getElementById('quick-test-output');
            
            resultsSection.style.display = 'block';
            output.textContent = 'Running quick tests...\n\n';
            
            const tests = [];
            
            // Test 1: EngineStatus
            tests.push('=== EngineStatus ===');
            if (window.EngineStatus) {
                tests.push('‚úÖ EngineStatus available');
                tests.push(`   Ready: ${EngineStatus.isReady()}`);
                tests.push(`   Health: ${EngineStatus.getHealthLabel()} (${EngineStatus.getHealthPercentage()}%)`);
            } else {
                tests.push('‚ùå EngineStatus not available');
            }
            
            // Test 2: FiveFactorLoader
            tests.push('\n=== FiveFactorLoader ===');
            if (window.FiveFactorLoader) {
                tests.push('‚úÖ FiveFactorLoader available');
                const status = FiveFactorLoader.getQuickStatus();
                tests.push(`   Ready: ${status.ready}`);
                tests.push(`   Loaded: ${status.loadedCount}/${status.totalCount}`);
            } else {
                tests.push('‚ùå FiveFactorLoader not available');
            }
            
            // Test 3: DemoData
            tests.push('\n=== DemoData ===');
            if (window.DemoData) {
                tests.push('‚úÖ DemoData available');
                tests.push(`   Platforms: ${DemoData.getAvailablePlatforms().join(', ')}`);
                const twitterDemo = DemoData.getResult('twitter', 'powerCheck');
                tests.push(`   Twitter demo: ${twitterDemo ? 'OK' : 'Missing'}`);
            } else {
                tests.push('‚ùå DemoData not available');
            }
            
            // Test 4: FlaggedHashtags
            tests.push('\n=== FlaggedHashtags ===');
            if (window.FlaggedHashtags) {
                tests.push('‚úÖ FlaggedHashtags available');
                const hashTest = FlaggedHashtags.check('#followback', 'twitter');
                tests.push(`   Test #followback: ${hashTest.status} (${hashTest.category || 'N/A'})`);
            } else {
                tests.push('‚ùå FlaggedHashtags not available');
            }
            
            // Test 5: Power Check
            tests.push('\n=== powerCheck Function ===');
            if (window.powerCheck) {
                tests.push('‚úÖ powerCheck available');
                try {
                    const result = await powerCheck('https://x.com/test/status/123');
                    tests.push(`   Test result: ${result.combinedVerdict || result.verdict || 'OK'}`);
                } catch (e) {
                    tests.push(`   Test error: ${e.message}`);
                }
            } else {
                tests.push('‚ùå powerCheck not available');
            }
            
            // Test 6: checkTags
            tests.push('\n=== checkTags Function ===');
            if (window.checkTags) {
                tests.push('‚úÖ checkTags available');
                try {
                    const result = await checkTags(['#test', '#followback'], 'twitter');
                    tests.push(`   Tags checked: ${result.summary?.total || 'N/A'}`);
                    tests.push(`   Banned: ${result.summary?.banned || 0}`);
                } catch (e) {
                    tests.push(`   Test error: ${e.message}`);
                }
            } else {
                tests.push('‚ùå checkTags not available');
            }
            
            output.textContent = tests.join('\n');
        }
        
        // =========================================
        // GLOBAL ERROR HANDLER
        // =========================================
        
        window.onerror = function(msg, url, line, col, error) {
            results.errors.push(`JS Error: ${msg} (${url}:${line})`);
            return false;
        };
        
        // =========================================
        // RUN ON LOAD
        // =========================================
        
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(runDiagnostic, 100);
        });
    </script>
</body>
</html>
