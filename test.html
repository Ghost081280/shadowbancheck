<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß™ 5-Factor Engine Test Suite</title>
    <style>
        :root {
            --bg: #0a0a0f;
            --card: #12121a;
            --border: #2a2a3a;
            --text: #e4e4e7;
            --muted: #71717a;
            --success: #22c55e;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #3b82f6;
            --primary: #6366f1;
        }
        
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            padding: 1rem;
        }
        
        .container { max-width: 1000px; margin: 0 auto; }
        
        header {
            text-align: center;
            padding: 2rem 1rem;
            border-bottom: 1px solid var(--border);
            margin-bottom: 2rem;
        }
        
        h1 { font-size: 1.75rem; margin-bottom: 0.5rem; }
        .subtitle { color: var(--muted); }
        
        /* Status Panel */
        .status-panel {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .status-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .status-header h2 { font-size: 1.25rem; }
        
        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .status-badge.excellent { background: var(--success); color: #000; }
        .status-badge.good { background: #84cc16; color: #000; }
        .status-badge.degraded { background: var(--warning); color: #000; }
        .status-badge.offline { background: var(--danger); color: #fff; }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--muted);
            font-size: 0.9rem;
        }
        
        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        .status-dot.ready { background: var(--success); }
        .status-dot.loading { background: var(--warning); }
        .status-dot.error { background: var(--danger); }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* Factor Cards */
        .factor-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }
        
        .factor-card {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
            position: relative;
        }
        
        .factor-card.online { border-color: var(--success); }
        .factor-card.offline { border-color: var(--danger); opacity: 0.7; }
        
        .factor-icon { font-size: 1.5rem; margin-bottom: 0.5rem; }
        .factor-name { font-size: 0.85rem; font-weight: 600; }
        .factor-weight { font-size: 0.75rem; color: var(--muted); }
        
        .factor-status {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
        }
        
        .factor-status.online { background: var(--success); color: #000; }
        .factor-status.offline { background: var(--danger); color: #fff; }
        
        /* Module Grid */
        .module-section {
            margin-top: 1.5rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border);
        }
        
        .module-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            cursor: pointer;
        }
        
        .module-header h3 {
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .module-count {
            font-size: 0.85rem;
            color: var(--muted);
        }
        
        .module-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 0.5rem;
        }
        
        .module-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            background: var(--bg);
            border-radius: 4px;
            font-size: 0.8rem;
        }
        
        .module-item.loaded { color: var(--success); }
        .module-item.missing { color: var(--danger); opacity: 0.7; }
        
        /* Test Cards */
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .test-card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
        }
        
        .test-header {
            padding: 1rem 1.5rem;
            background: rgba(99, 102, 241, 0.1);
            border-bottom: 1px solid var(--border);
        }
        
        .test-header h3 {
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .test-content { padding: 1.5rem; }
        
        .test-input {
            width: 100%;
            padding: 0.75rem;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }
        
        .test-input:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        textarea.test-input {
            min-height: 80px;
            resize: vertical;
        }
        
        .test-presets {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }
        
        .preset-btn {
            padding: 0.25rem 0.5rem;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 4px;
            color: var(--muted);
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .preset-btn:hover {
            border-color: var(--primary);
            color: var(--text);
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
            width: 100%;
        }
        
        .btn-primary { background: var(--primary); color: #fff; }
        .btn-primary:hover { background: #818cf8; }
        .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; }
        
        .btn-success { background: var(--success); color: #000; }
        
        /* Results */
        .test-result {
            margin-top: 1rem;
            padding: 1rem;
            background: var(--bg);
            border-radius: 8px;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.8rem;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            display: none;
        }
        
        .test-result.visible { display: block; }
        .test-result.success { border-left: 3px solid var(--success); }
        .test-result.error { border-left: 3px solid var(--danger); }
        
        /* Footer */
        footer {
            text-align: center;
            padding: 2rem;
            color: var(--muted);
            font-size: 0.85rem;
        }
        
        footer a { color: var(--primary); text-decoration: none; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üß™ 5-Factor Engine Test Suite</h1>
            <p class="subtitle">Real-time engine status & functional tests</p>
        </header>
        
        <!-- Engine Status Panel -->
        <div class="status-panel">
            <div class="status-header">
                <h2>‚ö° Engine Status</h2>
                <span id="health-badge" class="status-badge offline">Loading...</span>
            </div>
            
            <div class="status-indicator">
                <span id="status-dot" class="status-dot loading"></span>
                <span id="status-text">Checking modules...</span>
            </div>
            
            <!-- 5 Factor Cards -->
            <div class="factor-grid" id="factor-grid">
                <!-- Populated by JS -->
            </div>
            
            <!-- Module Details -->
            <div class="module-section">
                <div class="module-header" onclick="toggleModules()">
                    <h3>üì¶ Module Details</h3>
                    <span id="module-count" class="module-count">0/0 loaded</span>
                </div>
                <div id="module-grid" class="module-grid">
                    <!-- Populated by JS -->
                </div>
            </div>
        </div>
        
        <!-- Test Cards -->
        <div class="test-grid">
            <!-- Power Check Test -->
            <div class="test-card">
                <div class="test-header">
                    <h3>üîç Power Check</h3>
                </div>
                <div class="test-content">
                    <input type="text" id="power-url" class="test-input" placeholder="Enter URL to check...">
                    <div class="test-presets">
                        <button class="preset-btn" onclick="setPreset('power', 'https://x.com/elonmusk/status/123')">Twitter Post</button>
                        <button class="preset-btn" onclick="setPreset('power', 'https://x.com/shadowbantest')">Twitter Profile</button>
                        <button class="preset-btn" onclick="setPreset('power', 'https://reddit.com/r/test/comments/abc123')">Reddit Post</button>
                    </div>
                    <button class="btn btn-primary" onclick="runPowerCheck()">Run Power Check</button>
                    <div id="power-result" class="test-result"></div>
                </div>
            </div>
            
            <!-- Account Check Test -->
            <div class="test-card">
                <div class="test-header">
                    <h3>üë§ Account Check</h3>
                </div>
                <div class="test-content">
                    <input type="text" id="account-username" class="test-input" placeholder="@username">
                    <select id="account-platform" class="test-input">
                        <option value="twitter">Twitter/X</option>
                        <option value="reddit">Reddit</option>
                        <option value="instagram" disabled>Instagram (coming soon)</option>
                    </select>
                    <button class="btn btn-primary" onclick="runAccountCheck()">Check Account</button>
                    <div id="account-result" class="test-result"></div>
                </div>
            </div>
            
            <!-- Tag Check Test -->
            <div class="test-card">
                <div class="test-header">
                    <h3>#Ô∏è‚É£ Tag Check</h3>
                </div>
                <div class="test-content">
                    <textarea id="tag-input" class="test-input" placeholder="Enter hashtags or cashtags...">#test #shadowban $BTC</textarea>
                    <div class="test-presets">
                        <button class="preset-btn" onclick="setPreset('tag', '#followback #f4f #teamfollowback')">Banned Tags</button>
                        <button class="preset-btn" onclick="setPreset('tag', '$BTC $ETH $SCAM $DOGE')">Cashtags</button>
                        <button class="preset-btn" onclick="setPreset('tag', '#photography #nature #travel')">Safe Tags</button>
                    </div>
                    <button class="btn btn-primary" onclick="runTagCheck()">Check Tags</button>
                    <div id="tag-result" class="test-result"></div>
                </div>
            </div>
            
            <!-- Content Analysis Test -->
            <div class="test-card">
                <div class="test-header">
                    <h3>üìù Content Analysis</h3>
                </div>
                <div class="test-content">
                    <textarea id="content-input" class="test-input" placeholder="Enter text to analyze..."></textarea>
                    <div class="test-presets">
                        <button class="preset-btn" onclick="setPreset('content', 'FREE CRYPTO GIVEAWAY! Follow and RT to win! DM for collab üöÄüöÄüöÄ bit.ly/scam')">Spam Example</button>
                        <button class="preset-btn" onclick="setPreset('content', 'Just had a great coffee at the local cafe. Beautiful weather today!')">Clean Example</button>
                    </div>
                    <button class="btn btn-primary" onclick="runContentAnalysis()">Analyze Content</button>
                    <div id="content-result" class="test-result"></div>
                </div>
            </div>
            
            <!-- Database Stats -->
            <div class="test-card">
                <div class="test-header">
                    <h3>üìä Database Stats</h3>
                </div>
                <div class="test-content">
                    <p style="color: var(--muted); margin-bottom: 1rem; font-size: 0.85rem;">
                        Load statistics from all detection databases
                    </p>
                    <button class="btn btn-primary" onclick="loadStats()">Load Stats</button>
                    <div id="stats-result" class="test-result"></div>
                </div>
            </div>
            
            <!-- Demo Data Test -->
            <div class="test-card">
                <div class="test-header">
                    <h3>üé≠ Demo Data Test</h3>
                </div>
                <div class="test-content">
                    <select id="demo-platform" class="test-input">
                        <option value="twitter">Twitter</option>
                        <option value="reddit">Reddit</option>
                        <option value="instagram">Instagram</option>
                        <option value="tiktok">TikTok</option>
                    </select>
                    <select id="demo-type" class="test-input">
                        <option value="powerCheck">Power Check</option>
                        <option value="accountCheck">Account Check</option>
                        <option value="tagCheck">Tag Check</option>
                    </select>
                    <button class="btn btn-primary" onclick="loadDemoData()">Load Demo Data</button>
                    <div id="demo-result" class="test-result"></div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>5-Factor Detection Engine Test Suite</p>
            <p><a href="index.html">‚Üê Back to Home</a> | <a href="engine-diagnostic.html">Run Diagnostic</a></p>
        </footer>
    </div>
    
    <!-- Load Scripts in Correct Order -->
    <!-- 1. Core files first -->
    <script src="js/platforms.js"></script>
    <script src="js/main.js"></script>
    <script src="js/demo-data.js"></script>
    
    <!-- 2. Databases -->
    <script src="js/detection/databases/flagged-content.js"></script>
    <script src="js/detection/databases/flagged-hashtags.js"></script>
    <script src="js/detection/databases/flagged-mentions.js"></script>
    <script src="js/detection/databases/flagged-emojis.js"></script>
    <script src="js/detection/databases/flagged-links.js"></script>
    <script src="js/detection/databases/flagged-images.js"></script>
    <script src="js/detection/databases/flagged-videos.js"></script>
    <script src="js/detection/databases/flagged-audio.js"></script>
    
    <!-- 3. Platforms -->
    <script src="js/detection/platforms/platform-base.js"></script>
    <script src="js/detection/platforms/twitter.js"></script>
    <script src="js/detection/platforms/reddit.js"></script>
    
    <!-- 4. Agents - BASE MUST BE FIRST -->
    <script src="js/detection/agents/agent-base.js"></script>
    <script src="js/detection/agents/agent-platform-api.js"></script>
    <script src="js/detection/agents/agent-web-analysis.js"></script>
    <script src="js/detection/agents/agent-historical.js"></script>
    <script src="js/detection/agents/agent-detection.js"></script>
    <script src="js/detection/agents/agent-predictive.js"></script>
    
    <!-- 5. Engine & API -->
    <script src="js/detection/5-factor-engine.js"></script>
    <script src="js/detection-api.js"></script>
    
    <!-- 6. Page scripts (uses engine) -->
    <script src="js/index.js"></script>
    
    <script>
        // =========================================
        // MODULE DEFINITIONS - MATCHING YOUR FILES
        // =========================================
        
        const MODULES = {
            // Databases
            databases: [
                { name: 'FlaggedContent', global: 'FlaggedContent' },
                { name: 'FlaggedHashtags', global: 'FlaggedHashtags' },
                { name: 'FlaggedMentions', global: 'FlaggedMentions' },
                { name: 'FlaggedEmojis', global: 'FlaggedEmojis' },
                { name: 'FlaggedLinks', global: 'FlaggedLinks' },
                { name: 'FlaggedImages', global: 'FlaggedImages' },
                { name: 'FlaggedVideos', global: 'FlaggedVideos' },
                { name: 'FlaggedAudio', global: 'FlaggedAudio' },
            ],
            // Platforms
            platforms: [
                { name: 'PlatformBase', global: 'PlatformBase' },
                { name: 'TwitterPlatform', global: 'TwitterPlatform' },
                { name: 'RedditPlatform', global: 'RedditPlatform' },
                { name: 'PlatformFactory', global: 'PlatformFactory' },
            ],
            // Agents
            agents: [
                { name: 'AgentBase', global: 'AgentBase' },
                { name: 'AgentRegistry', global: 'AgentRegistry' },
                { name: 'PlatformAPIAgent', global: 'PlatformAPIAgent' },
                { name: 'WebAnalysisAgent', global: 'WebAnalysisAgent' },
                { name: 'HistoricalAgent', global: 'HistoricalAgent' },
                { name: 'DetectionAgent', global: 'DetectionAgent' },
                { name: 'PredictiveAgent', global: 'PredictiveAgent' },
            ],
            // Engine & Core
            engine: [
                { name: 'FiveFactorEngine', global: 'FiveFactorEngine' },
                { name: 'DetectionAPI', global: 'DetectionAPI' },
                { name: 'FiveFactorLoader', global: 'FiveFactorLoader' },
                { name: 'EngineStatus', global: 'EngineStatus' },
                { name: 'DemoData', global: 'DemoData' },
                { name: 'platformData', global: 'platformData' },
            ],
            // Functions
            functions: [
                { name: 'powerCheck', global: 'powerCheck' },
                { name: 'checkAccount', global: 'checkAccount' },
                { name: 'checkTags', global: 'checkTags' },
            ]
        };
        
        const FACTORS = [
            { id: 1, name: 'Platform API', weight: 20, icon: 'üîå', agents: ['PlatformAPIAgent'] },
            { id: 2, name: 'Web Analysis', weight: 20, icon: 'üîç', agents: ['WebAnalysisAgent'] },
            { id: 3, name: 'Historical Data', weight: 15, icon: 'üìä', agents: ['HistoricalAgent'] },
            { id: 4, name: 'Detection Engine', weight: 25, icon: '#Ô∏è‚É£', agents: ['DetectionAgent'] },
            { id: 5, name: 'Predictive AI', weight: 20, icon: 'ü§ñ', agents: ['PredictiveAgent'] },
        ];
        
        // =========================================
        // STATUS UPDATE
        // =========================================
        
        function checkModule(globalName) {
            return typeof window[globalName] !== 'undefined';
        }
        
        function updateStatus() {
            // Count loaded modules
            let loaded = 0;
            let total = 0;
            
            const allModules = [
                ...MODULES.databases,
                ...MODULES.platforms,
                ...MODULES.agents,
                ...MODULES.engine,
                ...MODULES.functions
            ];
            
            total = allModules.length;
            
            // Update module grid
            const moduleGrid = document.getElementById('module-grid');
            let moduleHtml = '';
            
            allModules.forEach(mod => {
                const isLoaded = checkModule(mod.global);
                if (isLoaded) loaded++;
                
                moduleHtml += `
                    <div class="module-item ${isLoaded ? 'loaded' : 'missing'}">
                        ${isLoaded ? '‚úÖ' : '‚ùå'} ${mod.name}
                    </div>
                `;
            });
            
            moduleGrid.innerHTML = moduleHtml;
            document.getElementById('module-count').textContent = `${loaded}/${total} loaded`;
            
            // Update factor cards
            const factorGrid = document.getElementById('factor-grid');
            let factorHtml = '';
            
            FACTORS.forEach(factor => {
                const isOnline = factor.agents.every(a => checkModule(a));
                
                factorHtml += `
                    <div class="factor-card ${isOnline ? 'online' : 'offline'}">
                        <div class="factor-status ${isOnline ? 'online' : 'offline'}">
                            ${isOnline ? '‚úì' : '‚úó'}
                        </div>
                        <div class="factor-icon">${factor.icon}</div>
                        <div class="factor-name">${factor.name}</div>
                        <div class="factor-weight">${factor.weight}% weight</div>
                    </div>
                `;
            });
            
            factorGrid.innerHTML = factorHtml;
            
            // Calculate health
            const onlineFactors = FACTORS.filter(f => f.agents.every(a => checkModule(a))).length;
            const healthPct = Math.round((onlineFactors / FACTORS.length) * 100);
            
            // Update health badge
            const badge = document.getElementById('health-badge');
            if (healthPct === 100) {
                badge.textContent = '100% Online';
                badge.className = 'status-badge excellent';
            } else if (healthPct >= 80) {
                badge.textContent = `${healthPct}% Online`;
                badge.className = 'status-badge good';
            } else if (healthPct >= 40) {
                badge.textContent = `${healthPct}% Degraded`;
                badge.className = 'status-badge degraded';
            } else {
                badge.textContent = `${healthPct}% Offline`;
                badge.className = 'status-badge offline';
            }
            
            // Update status indicator
            const dot = document.getElementById('status-dot');
            const text = document.getElementById('status-text');
            
            if (loaded === total) {
                dot.className = 'status-dot ready';
                text.textContent = `Engine ready! ${loaded}/${total} modules loaded`;
            } else if (loaded > 0) {
                dot.className = 'status-dot loading';
                text.textContent = `Loading... ${loaded}/${total} modules`;
            } else {
                dot.className = 'status-dot error';
                text.textContent = 'Engine offline - no modules loaded';
            }
        }
        
        function toggleModules() {
            const grid = document.getElementById('module-grid');
            grid.style.display = grid.style.display === 'none' ? 'grid' : 'none';
        }
        
        // =========================================
        // TEST FUNCTIONS
        // =========================================
        
        function setPreset(type, value) {
            const inputs = {
                power: 'power-url',
                tag: 'tag-input',
                content: 'content-input'
            };
            
            if (inputs[type]) {
                document.getElementById(inputs[type]).value = value;
            }
        }
        
        function showResult(elementId, content, isSuccess = true) {
            const el = document.getElementById(elementId);
            el.textContent = typeof content === 'object' ? JSON.stringify(content, null, 2) : content;
            el.className = `test-result visible ${isSuccess ? 'success' : 'error'}`;
        }
        
        async function runPowerCheck() {
            const url = document.getElementById('power-url').value.trim();
            if (!url) {
                showResult('power-result', 'Please enter a URL', false);
                return;
            }
            
            try {
                if (window.powerCheck) {
                    const result = await window.powerCheck(url);
                    showResult('power-result', result);
                } else if (window.DemoData) {
                    const platform = url.includes('reddit') ? 'reddit' : 'twitter';
                    const result = DemoData.getResult(platform, 'powerCheck');
                    showResult('power-result', { source: 'DemoData', ...result });
                } else {
                    showResult('power-result', 'powerCheck not available', false);
                }
            } catch (e) {
                showResult('power-result', `Error: ${e.message}`, false);
            }
        }
        
        async function runAccountCheck() {
            const username = document.getElementById('account-username').value.trim().replace('@', '');
            const platform = document.getElementById('account-platform').value;
            
            if (!username) {
                showResult('account-result', 'Please enter a username', false);
                return;
            }
            
            try {
                if (window.checkAccount) {
                    const result = await window.checkAccount(username, platform);
                    showResult('account-result', result);
                } else if (window.DemoData) {
                    const result = DemoData.getResult(platform, 'accountCheck');
                    showResult('account-result', { source: 'DemoData', ...result });
                } else {
                    showResult('account-result', 'checkAccount not available', false);
                }
            } catch (e) {
                showResult('account-result', `Error: ${e.message}`, false);
            }
        }
        
        async function runTagCheck() {
            const input = document.getElementById('tag-input').value.trim();
            if (!input) {
                showResult('tag-result', 'Please enter hashtags or cashtags', false);
                return;
            }
            
            // Parse tags
            const tags = input.match(/[#$][a-zA-Z0-9_]+/g) || [];
            
            if (tags.length === 0) {
                showResult('tag-result', 'No valid hashtags or cashtags found', false);
                return;
            }
            
            try {
                if (window.checkTags) {
                    const result = await window.checkTags(tags, 'twitter');
                    showResult('tag-result', result);
                } else if (window.FlaggedHashtags && window.FlaggedHashtags.checkBulk) {
                    const result = FlaggedHashtags.checkBulk(tags, 'twitter');
                    showResult('tag-result', { source: 'FlaggedHashtags', ...result });
                } else if (window.DemoData) {
                    const result = DemoData.getResult('twitter', 'tagCheck');
                    showResult('tag-result', { source: 'DemoData', ...result });
                } else {
                    showResult('tag-result', 'No tag check method available', false);
                }
            } catch (e) {
                showResult('tag-result', `Error: ${e.message}`, false);
            }
        }
        
        async function runContentAnalysis() {
            const text = document.getElementById('content-input').value.trim();
            if (!text) {
                showResult('content-result', 'Please enter text to analyze', false);
                return;
            }
            
            const results = {
                text: text,
                analysis: {}
            };
            
            try {
                // Check with FlaggedContent
                if (window.FlaggedContent && window.FlaggedContent.analyze) {
                    results.analysis.content = FlaggedContent.analyze(text);
                }
                
                // Extract and check hashtags
                const hashtags = text.match(/#[a-zA-Z0-9_]+/g) || [];
                if (hashtags.length > 0 && window.FlaggedHashtags) {
                    results.analysis.hashtags = FlaggedHashtags.checkBulk(hashtags, 'twitter');
                }
                
                // Extract and check cashtags
                const cashtags = text.match(/\$[a-zA-Z0-9_]+/g) || [];
                if (cashtags.length > 0 && window.FlaggedHashtags) {
                    results.analysis.cashtags = FlaggedHashtags.checkBulk(cashtags, 'twitter');
                }
                
                // Extract and check links
                const links = text.match(/https?:\/\/[^\s]+/g) || [];
                if (links.length > 0 && window.FlaggedLinks) {
                    results.analysis.links = FlaggedLinks.checkBulk(links, 'twitter');
                }
                
                // Check emojis
                if (window.FlaggedEmojis && window.FlaggedEmojis.analyze) {
                    results.analysis.emojis = FlaggedEmojis.analyze(text);
                }
                
                showResult('content-result', results);
            } catch (e) {
                showResult('content-result', `Error: ${e.message}`, false);
            }
        }
        
        function loadStats() {
            const stats = {
                databases: {},
                engine: {},
                agents: {}
            };
            
            // Database stats
            if (window.FlaggedHashtags?.getStats) {
                stats.databases.hashtags = FlaggedHashtags.getStats();
            }
            if (window.FlaggedContent?.getStats) {
                stats.databases.content = FlaggedContent.getStats();
            }
            if (window.FlaggedLinks?.getStats) {
                stats.databases.links = FlaggedLinks.getStats();
            }
            if (window.FlaggedEmojis?.getStats) {
                stats.databases.emojis = FlaggedEmojis.getStats();
            }
            if (window.FlaggedMentions?.getStats) {
                stats.databases.mentions = FlaggedMentions.getStats();
            }
            
            // Engine status
            if (window.EngineStatus) {
                stats.engine = EngineStatus.getQuickStatus();
            }
            
            // Agent registry
            if (window.AgentRegistry) {
                const agents = AgentRegistry.getAll();
                for (const [id, agent] of Object.entries(agents)) {
                    stats.agents[id] = agent.getInfo();
                }
            }
            
            showResult('stats-result', stats);
        }
        
        function loadDemoData() {
            const platform = document.getElementById('demo-platform').value;
            const type = document.getElementById('demo-type').value;
            
            if (window.DemoData) {
                const result = DemoData.getResult(platform, type);
                showResult('demo-result', {
                    platform,
                    type,
                    data: result || 'No demo data available for this combination'
                });
            } else {
                showResult('demo-result', 'DemoData not available', false);
            }
        }
        
        // =========================================
        // INIT
        // =========================================
        
        // Initial status check
        document.addEventListener('DOMContentLoaded', () => {
            // Wait a bit for scripts to execute
            setTimeout(updateStatus, 500);
            
            // Keep checking every 2 seconds while loading
            const interval = setInterval(() => {
                updateStatus();
                
                // Stop checking once everything is loaded
                const allModules = [
                    ...MODULES.databases,
                    ...MODULES.platforms,
                    ...MODULES.agents,
                    ...MODULES.engine,
                    ...MODULES.functions
                ];
                
                const loaded = allModules.filter(m => checkModule(m.global)).length;
                if (loaded === allModules.length) {
                    clearInterval(interval);
                }
            }, 2000);
            
            // Stop after 30 seconds regardless
            setTimeout(() => clearInterval(interval), 30000);
        });
    </script>
</body>
</html>
